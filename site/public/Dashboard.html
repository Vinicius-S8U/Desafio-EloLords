<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Cinzel:wght@600&display=swap"
        rel="stylesheet">
    <script src="/Script/Script.js"></script>
    <link rel="stylesheet" href="CSS/Style-Dashboard.css">
    <script src="/Script/funcoes.js"></script>
    <title>Dashboard</title>
</head>

<body>

    <div id="header">
        <div id="container_header">

            <img id="Logo" src="/ImgDeItens/logos/logo-new-color.png">

            <ul id="navbar">
                <li id="navbar_itens">
                    <a href="cards.html">Questionário</a>
                    <a href="#">Dashboard</a>
                    <a>|</a>
                    <a href="index.html" onclick="limparSessao()">Sair</a>
                </li>
            </ul>

        </div>
    </div>

    <h2 class="h1_pct">Quantidade de Pessoas que realizaram o Questionário:<span id="qtd_pessoas"></span></h2>


    <div class="control_cards">

        <div class="titulo_coment" id="t1">

            <div class="coment">

                <span id="m25pct">0</span>

            </div>

            <span>Pessoas que acertaram - de 25%</span>

        </div>

        <div class="titulo_coment" id="t2">

            <div class="coment">

                <span id="m50pct">0</span>

            </div>

            <span>Pessoas que acertaram entre 25% 50%</span>

        </div>

        <div class="titulo_coment" id="t3">

            <div class="coment">

                <span id="m75pct">0</span>

            </div>

            <span>Pessoas que acertaram entre 50% 75%</span>

        </div>

        <div class="titulo_coment" id="t4">

            <div class="coment">

                <span id="s75pct">0</span>

            </div>

            <span>Pessoas que acertaram + de 75%</span>

        </div>
    </div>

    <div class="control_graph">
        <canvas id="bar"></canvas>
    </div>


    <div class="control_graph">
        <canvas id="dough"></canvas>
        
    </div>
 


</section>


<footer>

    <span id="span_footer">Elo-Lords All rights Copyrighted &copy;</span>


</footer>

</body>

</html>

<script type="text/javascript" src="https://www.chartjs.org/dist/2.8.0/Chart.min.js"></script>

<script>

    id_usuario = sessionStorage.ID_USUARIO

    window.onload = obterdadosCards()


    window.onload = congratulations(id_usuario)


    function congratulations(id_usuario){
        fetch(`/medidas/acertosus/${id_usuario}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

           
                      alert(`Você acertou ${resposta[0].acertos} de 9.`)

                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    
    }


    function obterdadosCards() {

        fetch(`/medidas/acertos`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);                 

                    plotarGrafico(resposta)
                    plotarGrafico2(resposta)

                    var a = resposta[0]
                

                    qtd_pessoas.innerHTML = `${resposta[0].qtd_pessoas}`
                    m25pct.innerHTML = `${a.acertos0 + a.acertos1 + a.acertos2}`
                    m50pct.innerHTML = `${a.acertos3 + a.acertos4}`
                    m75pct.innerHTML = `${a.acertos5 + a.acertos6}`
                    s75pct.innerHTML = `${a.acertos7 + a.acertos8 + a.acertos9}`


                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });



        setTimeout(() => obterdadosCards(), 20000)
    }

    // Esta função *plotarGrafico* usa os dados capturados na função anterior para criar o gráfico
    // Configura o gráfico (cores, tipo, etc), materializa-o na página e, 
    // A função *plotarGrafico* também invoca a função *atualizarGrafico*
    function plotarGrafico(resposta) {
        console.log('iniciando plotagem do gráfico...');

        var dados = {
            labels: [],
            datasets: [
                {
                    yAxisID: 'y-acertos',
                    label: 'Quantas Acertos as Pessoas Tiveram',
                    borderColor: '#32B9CD',
                    backgroundColor: '#32b9cd8f',
                    fill: true,
                    data: []
                },
            ]
        };


        var registro = resposta[0];
         
        dados.labels.push('0 Acertos');
        dados.labels.push('1 Acertos');
        dados.labels.push('2 Acertos');
        dados.labels.push('3 Acertos');
        dados.labels.push('4 Acertos');
        dados.labels.push('5 Acertos');
        dados.labels.push('6 Acertos');
        dados.labels.push('7 Acertos');
        dados.labels.push('8 Acertos');
        dados.labels.push('9 Acertos');

        dados.datasets[0].data.push(registro.acertos0);
        dados.datasets[0].data.push(registro.acertos1);
        dados.datasets[0].data.push(registro.acertos2);
        dados.datasets[0].data.push(registro.acertos3);
        dados.datasets[0].data.push(registro.acertos4);
        dados.datasets[0].data.push(registro.acertos5);
        dados.datasets[0].data.push(registro.acertos6);
        dados.datasets[0].data.push(registro.acertos7);
        dados.datasets[0].data.push(registro.acertos8);
        dados.datasets[0].data.push(registro.acertos9);


        console.log(JSON.stringify(dados));

        var ctx = bar.getContext('2d');
        window.grafico_linha = Chart.Bar(ctx, {
            data: dados,
            options: {
                responsive: true,
                animation: { duration: 500 },
                hoverMode: 'index',
                stacked: false,
                title: {
                    display: false,
                    text: 'Dados capturados'
                },
                scales: {
                    yAxes: [{
                        type: 'linear',
                        display: true,
                        position: 'left',
                        id: 'y-temperatura',
                        ticks: {
                            beginAtZero: true,
                            max: 15,
                            min: 0
                        }
                    }, {
                        type: 'linear',
                        display: false,
                        position: 'right',
                        id: 'y-acertos',
                        ticks: {
                            beginAtZero: true,
                            max: 15,
                            min: 0
                        },

                        gridLines: {
                            drawOnChartArea: false,
                        },
                    }],
                }
            }
        });
    }

    function plotarGrafico2(resposta) {
        console.log('iniciando plotagem do gráfico...');

      
        var ctx = document.getElementById('dough').getContext('2d');

        var dados = new Chart(ctx, {
    type: 'doughnut',
    data: {
        labels: ['Joga Diariamente', 'Joga Muito', 'Não Joga', 'Joga Pouco'],
        datasets: [{
            label: 'Opinião sobre lol',
            data: [],
            backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)'
            ],
            borderColor: [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
            ],
            borderWidth: 0
        }]
    },
    options: {
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero: false
                }
            }]
        }
    }
});


        dados.config.data.datasets[0].data.push(resposta[0].diariamente);
        dados.config.data.datasets[0].data.push(resposta[0].muito);
        dados.config.data.datasets[0].data.push(resposta[0].nao);
        dados.config.data.datasets[0].data.push(resposta[0].pouco);


    }


</script>